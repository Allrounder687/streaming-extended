import"./modulepreload-polyfill.js";class r{constructor(){this.settings={},this.init()}async init(){await this.loadSettings(),this.setupEventListeners(),this.updateUI(),this.checkTabStatus(),this.loadStatistics()}async loadSettings(){return new Promise(t=>{chrome.storage.sync.get(["extensionEnabled","autoSkipIntro","autoSkipCredits","autoSkipRecap","autoNextEpisode","skipDelay","nextEpisodeDelay","showNotifications","showIMDBRatings"],e=>{this.settings={extensionEnabled:e.extensionEnabled!==void 0?e.extensionEnabled:!0,autoSkipIntro:e.autoSkipIntro!==void 0?e.autoSkipIntro:!0,autoSkipCredits:e.autoSkipCredits!==void 0?e.autoSkipCredits:!0,autoSkipRecap:e.autoSkipRecap!==void 0?e.autoSkipRecap:!0,autoNextEpisode:e.autoNextEpisode!==void 0?e.autoNextEpisode:!0,skipDelay:e.skipDelay||1e3,nextEpisodeDelay:e.nextEpisodeDelay!==void 0?e.nextEpisodeDelay:0,showNotifications:e.showNotifications!==void 0?e.showNotifications:!0,showIMDBRatings:e.showIMDBRatings!==void 0?e.showIMDBRatings:!0},t()})})}setupEventListeners(){document.getElementById("extensionEnabled").addEventListener("change",s=>{const i=s.target.checked;this.updateSetting("extensionEnabled",i),chrome.tabs.query({active:!0,currentWindow:!0},c=>{c[0]&&c[0].id&&chrome.tabs.sendMessage(c[0].id,{action:"setExtensionEnabled",enabled:i},d=>{chrome.runtime.lastError&&console.log("Streaming Extended: Content script not available")})}),chrome.storage.sync.set({extensionEnabled:i})}),document.querySelectorAll('input[type="checkbox"]:not(#extensionEnabled)').forEach(s=>{s.addEventListener("change",i=>{const c=i.target.id,d=i.target.checked;this.updateSetting(c,d)})}),document.getElementById("skipDelay").addEventListener("change",s=>{const i=parseInt(s.target.value);this.updateSetting("skipDelay",i)}),document.getElementById("nextEpisodeDelay").addEventListener("change",s=>{const i=parseInt(s.target.value);this.updateSetting("nextEpisodeDelay",i)}),document.getElementById("openOptions").addEventListener("click",()=>{chrome.runtime.openOptionsPage()})}updateSetting(t,e){this.settings[t]=e,chrome.storage.sync.set({[t]:e}),this.updateUI()}updateUI(){const t=document.getElementById("extensionEnabled");t.checked=this.settings.extensionEnabled,["autoSkipIntro","autoSkipCredits","autoSkipRecap","autoNextEpisode","showNotifications","showIMDBRatings"].forEach(a=>{const s=document.getElementById(a);s&&(s.checked=this.settings[a],s.disabled=!this.settings.extensionEnabled)}),["skipDelay","nextEpisodeDelay"].forEach(a=>{const s=document.getElementById(a);s&&(s.value=this.settings[a].toString(),s.disabled=!this.settings.extensionEnabled)}),document.querySelectorAll(".section:not(.master-toggle)").forEach(a=>{a.style.opacity=this.settings.extensionEnabled?"1":"0.6"})}async checkTabStatus(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0}),e=document.getElementById("status"),o=e.querySelector(".status-dot"),n=e.querySelector(".status-text"),s=["hotstar.com","netflix.com","primevideo.com","disneyplus.com","hulu.com","max.com"].find(i=>t&&t.url&&t.url.includes(i));if(s){o.style.background="#00ff88";const i=s.split(".")[0],c=i.charAt(0).toUpperCase()+i.slice(1);n.textContent=`Active on ${c}`}else o.style.background="#ff6b6b",n.textContent="Not on supported platform"}catch(t){console.error("Error checking tab status:",t)}}async loadStatistics(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});["hotstar.com","netflix.com","primevideo.com","disneyplus.com","hulu.com","max.com"].some(n=>t&&t.url&&t.url.includes(n))?chrome.tabs.sendMessage(t.id,{action:"getStatistics"},n=>{if(chrome.runtime.lastError){console.log("Streaming Extended: Content script not ready, loading from storage"),this.loadStatisticsFromStorage();return}n&&n.statistics?this.displayStatistics(n.statistics):this.loadStatisticsFromStorage()}):this.loadStatisticsFromStorage()}catch(t){console.error("Error loading statistics:",t),this.loadStatisticsFromStorage()}}loadStatisticsFromStorage(){chrome.storage.local.get(["streamingExtendedStats"],t=>{if(t.streamingExtendedStats){const e=this.processStatistics(t.streamingExtendedStats);this.displayStatistics(e)}else this.displayStatistics({totalSkips:0,timeSaved:"0s",thisWeekSkips:0,nextEpisodeClicks:0,topShows:[]})})}processStatistics(t){return{totalSkips:t.totalSkips||0,timeSaved:this.formatTime(t.timeSavedSeconds||0),timeSavedMinutes:Math.round((t.timeSavedSeconds||0)/60),thisWeekSkips:this.getThisWeekSkips(t.weeklyStats||{}),nextEpisodeClicks:t.nextEpisodeClicks||0,topShows:this.getTopShows(t.mostWatchedShows||{},3)}}formatTime(t){const e=Math.floor(t/3600),o=Math.floor(t%3600/60);return e>0?`${e}h ${o}m`:o>0?`${o}m`:`${t}s`}getThisWeekSkips(t){var s;const e=new Date,o=e.getFullYear(),n=this.getWeekNumber(e),a=`${o}-W${n}`;return((s=t[a])==null?void 0:s.skips)||0}getWeekNumber(t){const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),o=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-o);const n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-n)/864e5+1)/7)}getTopShows(t,e=3){return Object.entries(t).sort(([,o],[,n])=>n-o).slice(0,e).map(([o,n])=>({show:o,count:n}))}displayStatistics(t){document.getElementById("totalSkips").textContent=t.totalSkips,document.getElementById("timeSaved").textContent=t.timeSaved,document.getElementById("thisWeekSkips").textContent=t.thisWeekSkips,document.getElementById("nextEpisodeClicks").textContent=t.nextEpisodeClicks;const e=document.getElementById("showsList");t.topShows&&t.topShows.length>0?e.innerHTML=t.topShows.map(({show:o,count:n})=>`
        <div class="show-item">
          <div class="show-name" title="${o}">${o}</div>
          <div class="show-count">${n}</div>
        </div>
      `).join(""):e.innerHTML='<div class="no-data">No data yet</div>'}}document.addEventListener("DOMContentLoaded",()=>{new r});
